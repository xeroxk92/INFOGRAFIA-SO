<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma SOM02: Sistemas Operativos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #6366f1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #4f46e5; }

        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Navigation Styles */
        .nav-item { transition: all 0.2s; border-left: 4px solid transparent; cursor: pointer;}
        .nav-item:hover { background-color: #eef2ff; border-left-color: #6366f1; color: #4338ca; }
        .nav-item.active { background-color: #e0e7ff; border-left-color: #4338ca; color: #3730a3; font-weight: 600; }

        /* Interactive Components */
        .gantt-bar { transition: width 1s ease-out; }
        .memory-cell { transition: all 0.3s ease; }
        .concept-card { transition: transform 0.2s; }
        .concept-card:hover { transform: translateY(-2px); }
        
        /* Tooltip logic */
        .tooltip { position: relative; cursor: help; border-bottom: 1px dotted #666; }
        .tooltip:hover::after {
            content: attr(data-tip);
            position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
            background: #333; color: white; padding: 5px 10px; border-radius: 4px;
            font-size: 0.75rem; white-space: nowrap; z-index: 50; margin-bottom: 5px;
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden text-slate-800">

    <!-- SIDEBAR -->
    <aside class="w-80 bg-white border-r border-slate-200 flex flex-col z-20 shadow-xl">
        <div class="p-6 bg-gradient-to-r from-indigo-700 to-indigo-900 text-white shadow-md">
            <div class="flex items-center space-x-3">
                <i class="fas fa-book-open text-2xl opacity-80"></i>
                <div>
                    <h1 class="text-lg font-bold leading-tight tracking-wide">Master SOM02</h1>
                    <p class="text-xs text-indigo-200 font-light">Curso Interactivo Completo</p>
                </div>
            </div>
        </div>
        
        <nav class="flex-1 overflow-y-auto p-4 space-y-1">
            <p class="px-4 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 mt-2">Fundamentos</p>
            <div onclick="loadModule(1)" id="nav-1" class="nav-item w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 text-slate-600">
                <span class="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-0.5 rounded">1</span>
                <span class="text-sm">Concepto, Historia y Clasif.</span>
            </div>
            <div onclick="loadModule(2)" id="nav-2" class="nav-item w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 text-slate-600">
                <span class="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-0.5 rounded">2</span>
                <span class="text-sm">Funciones y Recursos</span>
            </div>
            <div onclick="loadModule(3)" id="nav-3" class="nav-item w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 text-slate-600">
                <span class="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-0.5 rounded">3</span>
                <span class="text-sm">Utilización (Interfaz)</span>
            </div>

            <p class="px-4 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 mt-6">Núcleo del Sistema</p>
            <div onclick="loadModule(4)" id="nav-4" class="nav-item w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 text-slate-600">
                <i class="fas fa-microchip text-red-500 w-5"></i>
                <span class="text-sm font-medium">Gestión de Procesos</span>
            </div>
            <div onclick="loadModule(5)" id="nav-5" class="nav-item w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 text-slate-600">
                <i class="fas fa-memory text-yellow-500 w-5"></i>
                <span class="text-sm font-medium">Gestión de Memoria</span>
            </div>

            <p class="px-4 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 mt-6">Almacenamiento</p>
            <div onclick="loadModule(6)" id="nav-6" class="nav-item w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 text-slate-600">
                <span class="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-0.5 rounded">6</span>
                <span class="text-sm">Sist. Archivos (Teoría)</span>
            </div>
            <div onclick="loadModule(7)" id="nav-7" class="nav-item w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 text-slate-600">
                <i class="fas fa-folder-tree text-purple-500 w-5"></i>
                <span class="text-sm font-medium">Implementación y Práctica</span>
            </div>

            <div class="mt-8 pt-4 border-t border-slate-100">
                <div onclick="loadModule('tutor')" id="nav-tutor" class="nav-item w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 text-slate-600">
                    <i class="fas fa-robot text-indigo-500 w-5"></i><span class="text-sm">Tutor IA</span>
                </div>
                <div onclick="loadModule('quiz')" id="nav-quiz" class="nav-item w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 text-slate-600">
                    <i class="fas fa-check-circle text-green-500 w-5"></i><span class="text-sm">Test Final</span>
                </div>
            </div>
        </nav>
    </aside>

    <!-- CONTENT AREA -->
    <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
        <header class="bg-white h-16 flex items-center justify-between px-8 shadow-sm z-10 border-b border-slate-200">
            <div>
                <h2 id="page-title" class="text-xl font-bold text-slate-800">Bienvenido</h2>
                <p id="page-subtitle" class="text-xs text-slate-500">Selecciona un módulo del menú lateral</p>
            </div>
            <div class="hidden md:flex items-center space-x-2 text-xs text-slate-400 bg-slate-50 px-3 py-1 rounded-full border border-slate-200">
                <i class="fas fa-check text-green-500"></i>
                <span>Contenido PDF verificado</span>
            </div>
        </header>

        <div id="content-container" class="flex-1 overflow-y-auto p-8 pb-20 scroll-smooth">
            <!-- Content injected here -->
        </div>
    </main>

    <!-- ================= TEMPLATES ================= -->

    <!-- TEMA 1: CONCEPTO, HISTORIA Y CLASIFICACIÓN -->
    <template id="tpl-1">
        <div class="max-w-5xl mx-auto space-y-10 fade-in">
            <!-- Introducción -->
            <section class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
                <h3 class="text-2xl font-bold text-slate-800 mb-4">¿Qué es un Sistema Operativo?</h3>
                <p class="text-slate-600 mb-6 leading-relaxed">
                    Imagina que el hardware (cables, chips) es una orquesta y los programas son los músicos. El <strong>Sistema Operativo (S.O.)</strong> es el <strong>Director de Orquesta</strong>. No toca los instrumentos, pero decide quién toca, cuándo y coordina todo para que no suene desafinado.
                </p>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-blue-50 p-5 rounded-xl border border-blue-100">
                        <h4 class="font-bold text-blue-900 mb-2 flex items-center"><i class="fas fa-magic mr-2"></i>1. Máquina Virtual (Comodidad)</h4>
                        <p class="text-sm text-blue-800">
                            Esconde la complejidad. Al usuario no le importa en qué sector del disco está un dato, solo ve "carpetas" y "archivos". Convierte el hardware difícil en algo fácil de usar.
                        </p>
                    </div>
                    <div class="bg-indigo-50 p-5 rounded-xl border border-indigo-100">
                        <h4 class="font-bold text-indigo-900 mb-2 flex items-center"><i class="fas fa-traffic-light mr-2"></i>2. Gestor de Recursos (Eficiencia)</h4>
                        <p class="text-sm text-indigo-800">
                            Reparte el "pastel" (CPU, Memoria, Disco) entre todos los programas para que ninguno se quede con hambre y no se peleen entre ellos.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Historia -->
            <section>
                <h3 class="text-xl font-bold text-slate-800 mb-6 pl-2 border-l-4 border-indigo-500">Evolución Histórica</h3>
                <div class="space-y-4 pl-4 border-l-2 border-slate-200 ml-2">
                    <!-- Gen 0 -->
                    <div class="relative pl-6">
                        <div class="absolute -left-[21px] top-1 w-10 h-10 bg-slate-200 rounded-full flex items-center justify-center font-bold text-slate-600 text-sm border-4 border-slate-50">0</div>
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                            <h4 class="font-bold text-slate-800">Generación 0 (< 1940): Mecánica</h4>
                            <p class="text-sm text-slate-600">Sin S.O. Interruptores y cables. Pioneros: Charles Babbage y Ada Lovelace.</p>
                        </div>
                    </div>
                    <!-- Gen 1 -->
                    <div class="relative pl-6">
                        <div class="absolute -left-[21px] top-1 w-10 h-10 bg-red-100 rounded-full flex items-center justify-center font-bold text-red-600 text-sm border-4 border-slate-50">1</div>
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                            <h4 class="font-bold text-slate-800">Gen 1 (1940-55): Válvulas de Vacío</h4>
                            <p class="text-sm text-slate-600">Ordenadores gigantes (ENIAC). Nace el <strong>Monitor Residente</strong>: un programa muy simple para limpiar la memoria entre trabajos.</p>
                        </div>
                    </div>
                    <!-- Gen 2 -->
                    <div class="relative pl-6">
                        <div class="absolute -left-[21px] top-1 w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center font-bold text-orange-600 text-sm border-4 border-slate-50">2</div>
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                            <h4 class="font-bold text-slate-800">Gen 2 (1955-65): Transistores</h4>
                            <p class="text-sm text-slate-600">Nace el <strong>Procesamiento por Lotes (Batch)</strong>. Para no perder tiempo, se agrupaban trabajos similares en tarjetas perforadas y se ejecutaban uno tras otro.</p>
                        </div>
                    </div>
                    <!-- Gen 3 -->
                    <div class="relative pl-6">
                        <div class="absolute -left-[21px] top-1 w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center font-bold text-yellow-600 text-sm border-4 border-slate-50">3</div>
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                            <h4 class="font-bold text-slate-800">Gen 3 (1965-80): Circuitos Integrados</h4>
                            <p class="text-sm text-slate-600 mb-2">IBM 360. Aparecen conceptos clave:</p>
                            <ul class="list-disc pl-4 text-xs text-slate-500 space-y-1">
                                <li><strong>Multiprogramación:</strong> Tener varios programas en memoria para aprovechar tiempos muertos.</li>
                                <li><strong>Tiempo Compartido:</strong> Interactividad con el usuario.</li>
                                <li><strong>Spooling:</strong> Usar el disco como almacén temporal para impresoras.</li>
                            </ul>
                        </div>
                    </div>
                    <!-- Gen 4 -->
                    <div class="relative pl-6">
                        <div class="absolute -left-[21px] top-1 w-10 h-10 bg-green-100 rounded-full flex items-center justify-center font-bold text-green-600 text-sm border-4 border-slate-50">4</div>
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                            <h4 class="font-bold text-slate-800">Gen 4 (1980-Act): Microprocesador</h4>
                            <p class="text-sm text-slate-600">El Ordenador Personal (PC). MS-DOS, Windows, MacOS, Linux. Interfaces Gráficas y Redes.</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </template>

    <!-- TEMA 2 y 3: FUNCIONES E INTERFAZ -->
    <template id="tpl-2">
        <div class="max-w-5xl mx-auto space-y-10 fade-in">
            <section class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-2xl border border-slate-200">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">Funciones Principales</h3>
                    <ul class="space-y-3 text-sm text-slate-600">
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> <strong>Procesos:</strong> Asigna CPU.</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> <strong>Memoria:</strong> Asigna RAM y protege espacios.</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> <strong>E/S:</strong> Controla periféricos mediante drivers.</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> <strong>Archivos:</strong> Organiza datos en disco.</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> <strong>Seguridad:</strong> Usuarios y permisos.</li>
                    </ul>
                </div>
                <div class="bg-white p-6 rounded-2xl border border-slate-200">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">Interfaces de Usuario</h3>
                    <div class="space-y-4">
                        <div class="bg-slate-900 p-3 rounded text-green-400 font-mono text-xs">
                            user@linux:~$ ls -la<br>
                            drwxr-xr-x ...
                        </div>
                        <p class="text-xs text-slate-500"><strong>CLI (Texto):</strong> Rápida y potente. Para expertos.</p>
                        
                        <div class="bg-blue-50 p-3 rounded border border-blue-100 flex justify-center gap-2">
                            <i class="fas fa-folder text-yellow-400 text-2xl"></i>
                            <i class="fas fa-file-word text-blue-500 text-2xl"></i>
                        </div>
                        <p class="text-xs text-slate-500"><strong>GUI (Gráfica):</strong> Ventanas e Iconos. Intuitiva.</p>
                    </div>
                </div>
            </section>
        </div>
    </template>
    
    <!-- TEMA 3: INTERFAZ (Redirige a 2 visualmente o se puede expandir, aquí unificado) -->
    <template id="tpl-3">
        <div class="max-w-5xl mx-auto fade-in bg-white p-8 rounded-2xl shadow">
            <h3 class="text-2xl font-bold text-slate-800 mb-4">Utilización y Administración</h3>
            <p class="text-slate-600 mb-4">El <strong>Administrador del Sistema (SysAdmin)</strong> es el superusuario encargado de:</p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div class="p-4 bg-slate-50 rounded border hover:bg-indigo-50 transition"><i class="fas fa-users mb-2 text-indigo-500"></i><br><span class="text-sm font-bold">Usuarios</span></div>
                <div class="p-4 bg-slate-50 rounded border hover:bg-indigo-50 transition"><i class="fas fa-shield-alt mb-2 text-indigo-500"></i><br><span class="text-sm font-bold">Seguridad</span></div>
                <div class="p-4 bg-slate-50 rounded border hover:bg-indigo-50 transition"><i class="fas fa-hdd mb-2 text-indigo-500"></i><br><span class="text-sm font-bold">Backups</span></div>
                <div class="p-4 bg-slate-50 rounded border hover:bg-indigo-50 transition"><i class="fas fa-chart-line mb-2 text-indigo-500"></i><br><span class="text-sm font-bold">Monitorizar</span></div>
            </div>
        </div>
    </template>

    <!-- TEMA 4: PROCESOS (REDISEÑO TOTAL) -->
    <template id="tpl-4">
        <div class="max-w-6xl mx-auto space-y-12 fade-in pb-10">
            <!-- Teoría Explicada -->
            <section class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
                <h3 class="text-2xl font-bold text-indigo-900 mb-6">Explicación de Algoritmos de Planificación</h3>
                <p class="text-slate-600 mb-6">Imagina que la CPU es la única <strong>caja abierta en un supermercado</strong> y los procesos son clientes con carros llenos o vacíos. El algoritmo decide quién paga primero.</p>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- FIFO -->
                    <div class="bg-slate-50 p-5 rounded-xl border border-slate-200">
                        <h4 class="font-bold text-slate-800 mb-2 flex items-center"><i class="fas fa-user-clock mr-2 text-blue-500"></i>FIFO / FCFS (First Come First Served)</h4>
                        <p class="text-sm text-slate-600 mb-2"><strong>La Cola Normal:</strong> El primero que llega, pasa. Si el primero lleva un carro llenísimo (proceso largo), todos los de atrás tienen que esperar aunque solo lleven una botella de agua.</p>
                        <p class="text-xs font-bold text-red-500">Problema: Efecto Convoy (los procesos cortos esperan mucho).</p>
                    </div>

                    <!-- SJF -->
                    <div class="bg-slate-50 p-5 rounded-xl border border-slate-200">
                        <h4 class="font-bold text-slate-800 mb-2 flex items-center"><i class="fas fa-compress-arrows-alt mr-2 text-green-500"></i>SJF (Shortest Job First)</h4>
                        <p class="text-sm text-slate-600 mb-2"><strong>La Caja Rápida:</strong> El cajero mira la cola y dice: "¡Que pasen primero los que tengan menos cosas!".</p>
                        <p class="text-xs font-bold text-green-600">Ventaja: Es el más eficiente. Minimiza el tiempo de espera promedio.</p>
                    </div>

                    <!-- Round Robin -->
                    <div class="bg-slate-50 p-5 rounded-xl border border-slate-200">
                        <h4 class="font-bold text-slate-800 mb-2 flex items-center"><i class="fas fa-sync-alt mr-2 text-purple-500"></i>Round Robin (Turno Rotatorio)</h4>
                        <p class="text-sm text-slate-600 mb-2"><strong>El Cronómetro:</strong> Cada cliente tiene 10 segundos (Quantum) para pasar productos. Si se acaba el tiempo y no ha terminado, vuelve al final de la cola y pasa el siguiente.</p>
                        <p class="text-xs font-bold text-purple-600">Ventaja: Justo. Nadie se queda bloqueado. Ideal para sistemas interactivos.</p>
                    </div>

                    <!-- Prioridades -->
                    <div class="bg-slate-50 p-5 rounded-xl border border-slate-200">
                        <h4 class="font-bold text-slate-800 mb-2 flex items-center"><i class="fas fa-star mr-2 text-yellow-500"></i>Por Prioridades</h4>
                        <p class="text-sm text-slate-600 mb-2"><strong>El Pase VIP:</strong> Algunos clientes tienen tarjeta VIP (procesos del sistema). Ellos siempre pasan antes, aunque lleguen tarde o tengan mucho que pagar.</p>
                    </div>
                </div>
            </section>

            <!-- Simulador Visual -->
            <section class="bg-white p-8 rounded-2xl shadow-xl border border-gray-200">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800"><i class="fas fa-play-circle mr-2 text-indigo-600"></i>Simulador en Tiempo Real</h3>
                        <p class="text-xs text-gray-500 mt-1">Escenario: <strong>P1 (Largo: 8s)</strong> llega primero, luego <strong>P2 (Corto: 2s)</strong> y <strong>P3 (Medio: 4s)</strong>.</p>
                    </div>
                    <div class="flex space-x-2 mt-4 md:mt-0">
                        <button onclick="simGantt('fifo')" class="px-4 py-2 bg-blue-600 text-white text-xs font-bold rounded-lg hover:bg-blue-700 transition shadow">Ejecutar FIFO</button>
                        <button onclick="simGantt('rr')" class="px-4 py-2 bg-purple-600 text-white text-xs font-bold rounded-lg hover:bg-purple-700 transition shadow">Ejecutar Round Robin</button>
                    </div>
                </div>

                <!-- Contenedor Gantt -->
                <div class="relative w-full bg-slate-100 h-20 rounded-xl border border-slate-300 overflow-hidden flex items-center justify-center" id="gantt-container">
                    <span class="text-slate-400 text-sm">Selecciona un algoritmo para ver la simulación</span>
                </div>

                <!-- Explicación Dinámica -->
                <div id="gantt-stats" class="mt-6 p-4 bg-slate-50 rounded-lg text-sm text-slate-700 border border-slate-200 min-h-[60px]"></div>
            </section>
        </div>
    </template>

    <!-- TEMA 5: MEMORIA (REDISEÑO TOTAL) -->
    <template id="tpl-5">
        <div class="max-w-6xl mx-auto space-y-12 fade-in pb-10">
            
            <!-- Concepto MMU -->
            <section class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
                <h3 class="text-2xl font-bold text-indigo-900 mb-6">Gestión de Memoria: Conceptos Clave</h3>
                <div class="flex flex-col md:flex-row gap-8 items-center">
                    <div class="flex-1 text-sm text-slate-600 space-y-4">
                        <p>El programa cree que tiene una memoria contigua y ordenada (<strong>Dirección Lógica</strong>), pero en realidad está disperso por los chips de RAM (<strong>Dirección Física</strong>).</p>
                        <div class="bg-indigo-50 p-4 rounded-lg border-l-4 border-indigo-500">
                            <strong>La MMU (Memory Management Unit):</strong> Es el hardware "traductor" que convierte al vuelo las direcciones lógicas en físicas. ¡Sin ella, el caos reinaría!
                        </div>
                    </div>
                    <div class="flex-1 flex items-center justify-center bg-slate-50 p-6 rounded-xl border border-slate-200">
                        <div class="text-center">
                            <div class="text-xs font-mono bg-white border p-2 mb-1">LOG: 0x100</div>
                            <div class="text-[10px] text-slate-400">CPU</div>
                        </div>
                        <i class="fas fa-arrow-right mx-2 text-slate-400"></i>
                        <div class="bg-indigo-600 text-white p-3 rounded-full text-xs font-bold shadow-lg z-10">MMU</div>
                        <i class="fas fa-arrow-right mx-2 text-slate-400"></i>
                        <div class="text-center">
                            <div class="text-xs font-mono bg-white border p-2 mb-1">FIS: 0x8F2</div>
                            <div class="text-[10px] text-slate-400">RAM</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Comparativa Frag -->
            <section class="grid md:grid-cols-2 gap-8">
                <!-- Segmentación -->
                <div class="bg-white p-6 rounded-2xl border border-red-100 shadow-sm group hover:shadow-md transition">
                    <h4 class="font-bold text-red-700 mb-2 flex items-center"><i class="fas fa-puzzle-piece mr-2"></i>1. Segmentación</h4>
                    <p class="text-xs text-slate-600 mb-4 h-10">Asigna bloques de tamaño variable según lo que pida el programa (Código, Datos, Pila...).</p>
                    
                    <div class="h-32 bg-slate-100 border rounded relative overflow-hidden">
                        <div class="absolute top-0 w-full h-[30%] bg-blue-200 border-b border-white flex items-center justify-center text-[10px]">Prog A (30%)</div>
                        <div class="absolute top-[30%] w-full h-[20%] bg-white flex items-center justify-center text-[10px] text-red-500 font-bold hatch-pattern">HUECO (Frag. Externa)</div>
                        <div class="absolute top-[50%] w-full h-[40%] bg-blue-200 border-y border-white flex items-center justify-center text-[10px]">Prog B (40%)</div>
                        <div class="absolute top-[90%] w-full h-[10%] bg-white flex items-center justify-center text-[10px] text-red-500 font-bold hatch-pattern">HUECO</div>
                    </div>
                    <p class="text-xs text-red-600 mt-3 font-semibold">Problema: Quedan huecos libres entre procesos (Fragmentación Externa).</p>
                </div>

                <!-- Paginación -->
                <div class="bg-white p-6 rounded-2xl border border-green-100 shadow-sm group hover:shadow-md transition">
                    <h4 class="font-bold text-green-700 mb-2 flex items-center"><i class="fas fa-th mr-2"></i>2. Paginación</h4>
                    <p class="text-xs text-slate-600 mb-4 h-10">Divide la memoria en trozos fijos iguales llamados <strong>Marcos</strong>. El programa se divide en <strong>Páginas</strong>.</p>
                    
                    <div class="h-32 bg-slate-100 border rounded grid grid-rows-4">
                        <div class="bg-green-200 border-b border-white flex items-center justify-center text-[10px]">Pag 1</div>
                        <div class="bg-green-200 border-b border-white flex items-center justify-center text-[10px]">Pag 2</div>
                        <div class="bg-green-200 border-b border-white flex items-center justify-center text-[10px]">Pag 3</div>
                        <div class="bg-green-200 flex relative">
                            <div class="w-[60%] h-full bg-green-300"></div>
                            <div class="w-[40%] h-full bg-yellow-100 flex items-center justify-center text-[9px] text-yellow-700 font-bold">DESPERDICIO</div>
                        </div>
                    </div>
                    <p class="text-xs text-green-600 mt-3 font-semibold">Ventaja: No hay huecos externos. <br>Defecto: Sobra un poco en la última página (Frag. Interna).</p>
                </div>
            </section>

            <!-- Simulador Interactivo -->
            <section class="bg-slate-800 text-white p-8 rounded-2xl shadow-xl">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="font-bold text-lg text-green-400"><i class="fas fa-gamepad mr-2"></i>Simulador de Memoria (Paginación)</h3>
                        <p class="text-xs text-slate-400">Añade procesos y observa cómo ocupan los marcos libres.</p>
                    </div>
                    <div class="space-x-2">
                        <button onclick="addProcessMem(2)" class="bg-blue-600 hover:bg-blue-500 px-3 py-1 rounded text-xs font-bold transition">App Pequeña (2 marcos)</button>
                        <button onclick="addProcessMem(5)" class="bg-purple-600 hover:bg-purple-500 px-3 py-1 rounded text-xs font-bold transition">App Grande (5 marcos)</button>
                        <button onclick="resetMemSim()" class="bg-red-600 hover:bg-red-500 px-3 py-1 rounded text-xs font-bold transition">Reset</button>
                    </div>
                </div>
                
                <!-- Grid -->
                <div class="grid grid-cols-8 gap-2 mb-4" id="mem-grid"></div>
                
                <!-- Leyenda -->
                <div class="flex justify-between items-center bg-slate-700 p-3 rounded-lg">
                    <div class="flex gap-4 text-xs">
                        <span class="flex items-center"><span class="w-3 h-3 bg-slate-600 mr-2 rounded-sm border border-slate-500"></span> Libre</span>
                        <span class="flex items-center"><span class="w-3 h-3 bg-green-500 mr-2 rounded-sm border border-green-400 shadow-[0_0_5px_#4ade80]"></span> Ocupado</span>
                    </div>
                    <div id="mem-msg" class="text-xs font-bold text-yellow-400">Sistema listo.</div>
                </div>
            </section>
        </div>
    </template>

    <!-- TEMA 5 (PDF): SISTEMAS ACTUALES -->
    <template id="tpl-5">
        <div class="max-w-5xl mx-auto space-y-10 fade-in">
            <section class="bg-white p-8 rounded-2xl shadow-sm border border-gray-200">
                <h3 class="text-xl font-bold text-gray-800 mb-6">5. Evolución de S.O. Actuales</h3>
                <div class="space-y-8">
                    <div>
                        <h4 class="font-bold text-blue-700 mb-2 flex items-center"><i class="fab fa-windows mr-2"></i>Windows</h4>
                        <p class="text-sm text-gray-600 mb-2">Inició como interfaz sobre MS-DOS. El gran salto fue <strong>Windows NT</strong> (New Technology), base de los actuales.</p>
                        <div class="flex flex-wrap gap-2 text-[10px]">
                            <span class="bg-gray-100 px-2 py-1 rounded">Win 95/98</span> <span class="bg-gray-100 px-2 py-1 rounded">XP (Gran éxito)</span> <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded font-bold">Win 10/11</span>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-bold text-yellow-600 mb-2 flex items-center"><i class="fab fa-linux mr-2"></i>GNU/Linux</h4>
                        <p class="text-sm text-gray-600 mb-2">Linus Torvalds creó el Kernel (1991). GNU puso las herramientas. Es el rey de los servidores y supercomputadoras.</p>
                        <p class="text-xs text-gray-500">Distros: Ubuntu, Debian, Red Hat.</p>
                    </div>
                </div>
            </section>
        </div>
    </template>

    <!-- TEMA 6 (PDF): ARCHIVOS CONCEPTOS -->
    <template id="tpl-6">
        <div class="max-w-5xl mx-auto space-y-10 fade-in">
            <section class="bg-white p-8 rounded-2xl shadow-sm border border-gray-200">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Conceptos de Archivos</h3>
                <ul class="space-y-3 text-sm text-gray-600">
                    <li><strong>Archivo:</strong> Unidad lógica con nombre.</li>
                    <li><strong>Directorio:</strong> Contenedor. Estructura de árbol invertido.</li>
                    <li><strong>Ruta Absoluta:</strong> Desde la raíz (ej: <code>C:\Windows\System32</code>).</li>
                    <li><strong>Ruta Relativa:</strong> Desde donde estás (ej: <code>.\documento.txt</code>).</li>
                </ul>
            </section>
        </div>
    </template>

    <!-- TEMA 7 (PDF): IMPLEMENTACIÓN DE ARCHIVOS -->
    <template id="tpl-7">
        <div class="max-w-6xl mx-auto space-y-10 fade-in pb-10">
            <!-- Teoría -->
            <section class="bg-white p-8 rounded-2xl shadow-sm border border-gray-200">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Física vs Lógica</h3>
                <div class="grid md:grid-cols-2 gap-8 text-sm">
                    <div>
                        <h4 class="font-bold text-indigo-700 mb-2">Unidades</h4>
                        <p class="text-slate-600 mb-2"><strong>Sector:</strong> Unidad física del disco (512 bytes).</p>
                        <p class="text-slate-600"><strong>Clúster (Bloque):</strong> Unidad lógica de asignación. Es el mínimo espacio que un archivo puede ocupar.</p>
                        <p class="text-xs text-red-500 mt-2 italic">Si guardas 1 byte en un clúster de 4KB, pierdes 4095 bytes (Slack Space).</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-indigo-700 mb-2">Sistemas</h4>
                        <ul class="list-disc pl-4 text-slate-600 space-y-1">
                            <li><strong>FAT32:</strong> Compatible. Máx archivo 4GB.</li>
                            <li><strong>NTFS:</strong> Windows. Seguridad, Journaling (recuperación).</li>
                            <li><strong>ext4:</strong> Linux. Muy eficiente.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Simulador Slack Space -->
            <section class="bg-indigo-50 p-8 rounded-2xl border border-indigo-100">
                <h4 class="font-bold text-indigo-900 mb-4">Simulador: El Desperdicio de Clúster</h4>
                <div class="flex flex-wrap gap-4 items-end text-sm">
                    <label>Tamaño Clúster: <select id="clus-size" class="p-1 rounded"><option value="4">4 KB (Estándar)</option><option value="32">32 KB (FAT32 viejo)</option></select></label>
                    <label>Archivo: <input type="number" id="file-size" value="1" class="w-16 p-1 rounded"> KB</label>
                    <button onclick="calcSlack()" class="bg-indigo-600 text-white px-4 py-1 rounded">Calcular</button>
                </div>
                <div id="slack-visual" class="h-12 bg-white rounded border mt-4 hidden overflow-hidden"><div id="slack-used" class="h-full bg-blue-500 float-left"></div><div id="slack-wasted" class="h-full bg-red-400 float-left hatch-pattern"></div></div>
                <div id="slack-result" class="mt-2 text-xs font-bold text-red-600"></div>
            </section>
        </div>
    </template>

    <!-- TUTOR IA -->
    <template id="tpl-tutor">
        <div class="max-w-3xl mx-auto h-[500px] flex flex-col bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white"><h3 class="text-xl font-bold flex items-center"><i class="fas fa-robot mr-3 text-2xl"></i> Tutor Virtual</h3></div>
            <div id="chat-history" class="flex-1 p-6 overflow-y-auto space-y-4 bg-gray-50"><div class="flex items-start"><div class="bg-white p-2 rounded-full mr-3 text-indigo-600"><i class="fas fa-robot"></i></div><div class="bg-white p-3 rounded-lg shadow-sm text-sm text-gray-700">Pregúntame por "Round Robin", "Paginación" o "Fragmentación".</div></div></div>
            <div class="p-4 bg-white border-t border-gray-200"><form onsubmit="handleChat(event)" class="flex gap-2"><input type="text" id="chat-input" class="flex-1 px-4 py-2 rounded-xl border text-sm" placeholder="Escribe tu duda..." autocomplete="off"><button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-xl"><i class="fas fa-paper-plane"></i></button></form></div>
        </div>
    </template>

    <!-- QUIZ -->
    <template id="tpl-quiz">
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-2xl shadow-lg border border-gray-100 mt-10 text-center"><h3 class="text-2xl font-bold text-gray-800 mb-6">Test Final</h3><div id="quiz-container"></div></div>
    </template>

    <script>
        const titles = {1:'Concepto e Historia',2:'Funciones y Recursos',3:'Utilización',4:'Procesos',5:'Sistemas Actuales',6:'Archivos (Teoría)',7:'Archivos (Práctica)','tutor':'Tutor IA','quiz':'Test'};
        
        function loadModule(id) {
            // UI Updates
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const nav = document.getElementById(`nav-${id}`);
            if(nav) nav.classList.add('active');
            document.getElementById('page-title').innerText = titles[id] || 'Módulo';
            
            // Inject
            const tpl = document.getElementById(`tpl-${id}`);
            const cont = document.getElementById('content-container');
            if(tpl) cont.innerHTML = tpl.innerHTML;
            
            // Init specific scripts
            if(id==2 || id==5) setTimeout(initMemSim, 100); // Memoria is in 2 now based on PDF? No, actually let's stick to structure.
            // Based on PDF: 2 is functions/resources (memoria is 2.3), 4 is processes, 5 systems, 6/7 files. 
            // So Mem Sim is in Module 5 (template tpl-5) in previous structure but let's ensure correct mapping.
            // In THIS code: Processes is tpl-4, Memory is tpl-5.
            if(id==5) setTimeout(initMemSim, 100); 
            if(id=='quiz') setTimeout(initQuiz, 100);
        }

        // --- SIMULATORS ---
        
        // GANTT (PROCESSES)
        function simGantt(algo) {
            const c = document.getElementById('gantt-container'), s = document.getElementById('gantt-stats');
            if(!c) return; c.innerHTML='';
            
            if(algo=='fifo') {
                // P1(8), P2(2), P3(4)
                c.innerHTML = '<div class="bg-blue-500 h-full w-[57%] text-white text-xs flex items-center justify-center">P1</div><div class="bg-red-500 h-full w-[14%] text-white text-xs flex items-center justify-center">P2</div><div class="bg-green-500 h-full w-[29%] text-white text-xs flex items-center justify-center">P3</div>';
                s.innerHTML = "<strong class='text-red-600'>FIFO:</strong> P2 (el corto) tuvo que esperar muchísimo a P1. Ineficiente.";
            } else if(algo=='sjf') {
                // P2(2), P3(4), P1(8)
                c.innerHTML = '<div class="bg-red-500 h-full w-[14%] text-white text-xs flex items-center justify-center">P2</div><div class="bg-green-500 h-full w-[29%] text-white text-xs flex items-center justify-center">P3</div><div class="bg-blue-500 h-full w-[57%] text-white text-xs flex items-center justify-center">P1</div>';
                s.innerHTML = "<strong class='text-green-600'>SJF:</strong> Perfecto. Los trabajos cortos salieron volando.";
            } else {
                // RR
                c.innerHTML = '<div class="bg-blue-500 h-full w-[20%] border-r">P1</div><div class="bg-red-500 h-full w-[20%] border-r">P2</div><div class="bg-green-500 h-full w-[20%] border-r">P3</div><div class="bg-blue-500 h-full w-[20%] border-r">P1</div><div class="bg-green-500 h-full w-[20%]">P3</div>';
                s.innerHTML = "<strong class='text-purple-600'>Round Robin:</strong> Justo. Todos avanzan un poco cada vez.";
            }
        }
        function explainState(s) { const m={'nuevo':'Creando PCB...','listo':'En RAM, espera CPU.','ejecucion':'¡Trabajando!','bloqueado':'Espera disco/teclado.','terminado':'Fin.'}; document.getElementById('process-info-box').innerText=m[s]; }

        // MEMORY
        let mBlocks = Array(32).fill(0);
        function initMemSim() {
            const g = document.getElementById('mem-grid');
            if(!g) return; g.innerHTML='';
            mBlocks.forEach((v,i) => g.innerHTML += `<div id="mb${i}" class="h-6 w-full rounded ${v?'bg-green-500':'bg-slate-700'} memory-cell border border-slate-600"></div>`);
        }
        function addProcessMem(n) {
            let free=[]; mBlocks.forEach((v,i)=>{if(!v)free.push(i)});
            if(free.length<n) { document.getElementById('mem-msg').innerText="¡RAM LLENA!"; return; }
            for(let i=0;i<n;i++) { let idx=free[i]; mBlocks[idx]=1; document.getElementById(`mb${idx}`).className="h-6 w-full rounded bg-green-500 memory-cell border border-green-400"; }
            document.getElementById('mem-msg').innerText=`Asignado (${n} marcos).`;
        }
        function resetMemSim() { mBlocks.fill(0); initMemSim(); document.getElementById('mem-msg').innerText="Limpio."; }

        // FILES
        function calcSlack() {
            const c=parseFloat(document.getElementById('clus-size').value), f=parseFloat(document.getElementById('file-size').value);
            if(f>c) return; // Simple logic
            const w=c-f, wp=(w/c)*100;
            document.getElementById('slack-visual').classList.remove('hidden');
            document.getElementById('slack-used').style.width=(100-wp)+'%'; document.getElementById('slack-wasted').style.width=wp+'%';
            document.getElementById('slack-result').innerText=`Desperdicio: ${w} KB`;
        }

        // CHAT
        const kb = {"round robin":"Algoritmo justo por turnos (Quantum).","fifo":"El primero que llega, entra. Injusto.","paginacion":"Memoria en bloques fijos.","fragmentacion":"Espacio perdido."};
        function handleChat(e) {
            e.preventDefault(); const i=document.getElementById('chat-input'), h=document.getElementById('chat-history');
            if(!i.value) return;
            h.innerHTML+=`<div class="flex justify-end mb-2"><div class="chat-bubble bg-indigo-600 text-white">${i.value}</div></div>`;
            let r="Intenta con 'Round Robin' o 'Paginación'."; for(let k in kb) if(i.value.toLowerCase().includes(k)) r=kb[k];
            setTimeout(()=>{ h.innerHTML+=`<div class="flex mb-2"><div class="chat-bubble bg-white border text-slate-700">${r}</div></div>`; h.scrollTop=h.scrollHeight; },500); i.value='';
        }

        // QUIZ
        let qI=0, sc=0; const qs=[{q:"¿Gestor HW?",o:["Kernel","Shell"],a:0},{q:"¿Algoritmo Quantum?",o:["FIFO","RR"],a:1}];
        function initQuiz() { qI=0; sc=0; document.getElementById('quiz-container').innerHTML=''; rendQ(); }
        function rendQ() {
            const c=document.getElementById('quiz-container');
            if(qI>=qs.length) { c.innerHTML=`Nota: ${sc}`; return; }
            c.innerHTML=`<p class='mb-4'>${qs[qI].q}</p>`+qs[qI].o.map((o,i)=>`<button onclick='ans(${i})' class='block w-full p-2 border mb-2 rounded hover:bg-indigo-50'>${o}</button>`).join('');
        }
        function ans(i) { if(i===qs[qI].a) sc++; qI++; rendQ(); }

        window.onload=()=>loadModule(1);
    </script>
</body>
</html>
